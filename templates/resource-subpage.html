<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ resource.name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

</head>
<body>
    {% include "_navbar.html" %}

    <!-- Banner -->
    <section class="relative">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_6f3xp_XkMte13BwJd7oEkqLceF8ljdy6lw&s" alt="Banner Image" class="w-full object-cover h-64">
        <h1 class="absolute bottom-4 left-6 text-4xl font-bold text-white drop-shadow-lg">
        {{ resource.name }} 
        </h1>
    </section>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto p-6 grid md:grid-cols-3 gap-6 body-font">
        <!-- Hours and Info -->
        <section class="md:col-span-2 bg-white p-5 rounded-xl shadow-sm border border-gray-200">
        <h2 class="text-2xl font-semibold mb-3 flex">Hours + Info</h2>
            <div class="flex flex-row align-start justify-between mb-2">
                <div class="text-gray-700 mr-4">
                {% for day, times in resource.hours.items() %}
                <p>
                    <span class="font-semibold">{{ day }}:</span>
                    {% if times %}
                    {{ times[0] }} ‚Äì {{ times[1] }}
                    {% else %}
                    Closed
                    {% endif %}
                </p>
                {% endfor %}
                </div>
                <div class="flex flex-col">
                    <div class="flex flex-row items-start gap-3 mb-3">
                        <img src="{{ url_for('static', filename='images/location.png') }}" alt="Location Icon" class="w-6 h-6 flex-shrink-0">
                        <p class="text-gray-700 mb-2">{{ resource.address }}</p>
                    </div>
                    <div class="flex flex-row items-start gap-2 mb-3">
                        <img src="{{ url_for('static', filename='images/phone.png') }}" alt="Phone Icon" class="w-6 h-6 flex-shrink-0">
                        <p class="text-gray-700 mb-2">{{ resource.phone }}</p>
                    </div>
                    <div class="flex flex-row items-start gap-3">
                        <img src="{{ url_for('static', filename='images/website.png') }}" alt="website Icon" class="w-6 h-6 flex-shrink-0">
                        <p class="text-gray-700 mb-2">{{ resource.website }}</p>
                    </div>
                </div>
            </div>
            <p class="text-gray-700 mt-4">{{ resource.description }}</p>
        </section>

        <!-- Buttons + Map -->
        <section class="space-y-4">
        <div class="flex justify-around bg-white p-3 rounded-xl shadow-sm border border-gray-200">
            <img src="{{ url_for('static', filename='images/bookmark.png') }}" alt="Bookmark Icon" class="w-7 h-auto">
            <img src="{{ url_for('static', filename='images/share-30.png') }}" alt="Share Icon" class="w-7 h-auto">
            <img src="{{ url_for('static', filename='images/comment-48.png') }}" alt="Comment Icon" class="w-7 h-auto">
        </div>
        <div style="height: 250px; border-radius: 2rem;" id="map"></div>
        </section>
    </main>

    <section class="max-w-6xl mx-auto mt-6 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h2 class="text-2xl font-semibold mb-4">Discussion</h2>

        <div id="comments" class="space-y-5 mb-4">
        <!-- Existing comments -->
        <div class="flex space-x-3">
            <img src="https://placehold.co/40x40" alt="User avatar" class="w-10 h-10 rounded-full">
            <div>
            <p class="font-semibold text-gray-900">sarah_k</p>
            <p class="text-gray-700">Does anyone know if they offer walk-in appointments, or do you have to schedule ahead?</p>
            <p class="text-xs text-gray-500 mt-1">2 hours ago</p>

            <div class="ml-10 mt-3 flex space-x-3">
                <img src="https://placehold.co/35x35" alt="User avatar" class="w-8 h-8 rounded-full">
                <div>
                <p class="font-semibold text-gray-900">Admin</p>
                <p class="text-gray-700">You can walk in for basic services, but scheduling ahead is recommended for anything longer than 30 minutes.</p>
                <p class="text-xs text-gray-500 mt-1">1 hour ago</p>
                </div>
            </div>
            </div>
        </div>

        <div class="flex space-x-3">
            <img src="https://placehold.co/40x40" alt="User avatar" class="w-10 h-10 rounded-full">
            <div>
            <p class="font-semibold text-gray-900">jayden_m</p>
            <p class="text-gray-700">I went here last week ‚Äî super friendly staff! They really helped me out with housing info.</p>
            <p class="text-xs text-gray-500 mt-1">Yesterday</p>
            </div>
        </div>

        <div class="flex space-x-3">
            <img src="https://placehold.co/40x40" alt="User avatar" class="w-10 h-10 rounded-full">
            <div>
            <p class="font-semibold text-gray-900">nina_rose</p>
            <p class="text-gray-700">Wish they had weekend hours though üò© it‚Äôs hard to make it during the week.</p>
            <p class="text-xs text-gray-500 mt-1">2 days ago</p>
            </div>
        </div>
        </div>

        <div>
        <textarea id="commentInput" placeholder="Add a comment..." class="w-full p-2 border rounded-md mb-2"></textarea>
        <button id="submitComment" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Submit</button>
        </div>
    </section>

    <footer class="text-center text-gray-500 py-6 text-sm">
        ¬©Ô∏è 2025 Resource Directory
    </footer>

    <!-- JS for comments and replies -->
    <!-- Inside the <script> for comments -->
    <script>
    const commentInput = document.getElementById('commentInput');
    const submitBtn = document.getElementById('submitComment');
    const commentsContainer = document.getElementById('comments');

    function createComment(username, text, time = "Just now") {
    const commentDiv = document.createElement('div');
    commentDiv.classList.add('flex', 'space-x-3');

    commentDiv.innerHTML = `
        <img src="https://placehold.co/40x40" alt="User avatar" class="w-10 h-10 rounded-full">
        <div>
        <p class="font-semibold text-gray-900">${username}</p>
        <p class="text-gray-700">${text}</p>
        <div class="flex items-center space-x-2 mt-1 text-xs text-gray-500">
            <span>${time}</span>
            <button class="reply-btn hover:underline">Reply</button>
        </div>
        <div class="ml-10 mt-2 flex space-x-3 reply-container"></div>
        <input type="text" placeholder="Reply..." class="reply-input hidden mt-2 p-1 border rounded-md text-sm w-full">
        </div>
    `;

    const replyBtn = commentDiv.querySelector('.reply-btn');
    const replyInput = commentDiv.querySelector('.reply-input');
    const replyContainer = commentDiv.querySelector('.reply-container');

    replyBtn.addEventListener('click', () => {
        replyInput.classList.toggle('hidden');
        replyInput.focus();
    });

    replyInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
        const replyText = replyInput.value.trim();
        if (replyText !== '') {
            const replyDiv = document.createElement('div');
            replyDiv.classList.add('flex', 'space-x-3');
            replyDiv.innerHTML = `
            <img src="https://placehold.co/35x35" alt="User avatar" class="w-8 h-8 rounded-full">
            <div>
                <p class="font-semibold text-gray-900">You</p>
                <p class="text-gray-700">${replyText}</p>
                <p class="text-xs text-gray-500 mt-1">Just now</p>
            </div>
            `;
            replyContainer.appendChild(replyDiv);
            replyInput.value = '';
            replyInput.classList.add('hidden');
        }
        }
    });

    return commentDiv;
    }

    submitBtn.addEventListener('click', () => {
    const text = commentInput.value.trim();
    if (text !== '') {
        const newComment = createComment("You", text);
        commentsContainer.appendChild(newComment);
        commentInput.value = '';
        newComment.scrollIntoView({ behavior: 'smooth' });
    }
    });

    // Add reply buttons to existing comments
    const existingComments = commentsContainer.querySelectorAll('.flex.space-x-3');
    existingComments.forEach(comment => {
    const div = comment.querySelector('div');
    if (!div.querySelector('.reply-btn')) {
        const timeSpan = div.querySelector('.text-xs.text-gray-500');
        const replyBtn = document.createElement('button');
        replyBtn.className = 'reply-btn text-xs text-gray-500 hover:underline';
        replyBtn.textContent = 'Reply';
        timeSpan.insertAdjacentElement('afterend', replyBtn);

        const replyContainer = document.createElement('div');
        replyContainer.classList.add('ml-10', 'mt-2', 'flex', 'space-x-3');
        div.appendChild(replyContainer);

        const replyInput = document.createElement('input');
        replyInput.type = 'text';
        replyInput.placeholder = 'Reply...';
        replyInput.className = 'reply-input hidden mt-2 p-1 border rounded-md text-sm w-full';
        div.appendChild(replyInput);

        replyBtn.addEventListener('click', () => {
        replyInput.classList.toggle('hidden');
        replyInput.focus();
        });

        replyInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const replyText = replyInput.value.trim();
            if (replyText !== '') {
            const replyDiv = document.createElement('div');
            replyDiv.classList.add('flex', 'space-x-3');
            replyDiv.innerHTML = `
                <img src="https://placehold.co/35x35" alt="User avatar" class="w-8 h-8 rounded-full">
                <div>
                <p class="font-semibold text-gray-900">You</p>
                <p class="text-gray-700">${replyText}</p>
                <p class="text-xs text-gray-500 mt-1">Just now</p>
                </div>
            `;
            replyContainer.appendChild(replyDiv);
            replyInput.value = '';
            replyInput.classList.add('hidden');
            }
        }
        });
    }
    });
    </script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const mapElement = document.getElementById("map");
            const resourceCoords = {{ resource.coords | tojson }};
            const map = L.map('map').setView(resourceCoords, 15);
            

            L.tileLayer('https://api.maptiler.com/maps/basic/{z}/{x}/{y}.png?key=LNbdm4h4Z8EJFZpmNIQS', {
                attribution: '&copy; MapTiler &copy; OpenStreetMap',
                tileSize: 512,
                zoomOffset: -1,
                minZoom: 12,
                maxZoom: 18
            }).addTo(map);
            L.marker(resourceCoords).addTo(map)
                .bindPopup(`<b>{{ resource.name }}</b>`, {maxWidth: 200, minWidth: 100, autoPan: true}).openPopup();
        });
    </script>



    
    <script src="{{ url_for('static', filename='js/sitewide.js') }}"></script>

</body>
</html>